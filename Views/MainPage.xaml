<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodel="clr-namespace:AuroraForecast.ViewModels"
             xmlns:model="clr-namespace:AuroraForecast.Models"
             xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
             x:Class="AuroraForecast.Views.MainPage"
             Title="{Binding Title}">

    <ContentPage.BindingContext>
        <viewmodel:MainPageViewModel />
    </ContentPage.BindingContext>

    <Grid>
        <!-- Video Background -->
        <!--<toolkit:MediaElement
            x:Name="BackgroundVideo"
            Source="{Binding CurrentVideoSource}"
            ShouldAutoPlay="True"
            ShouldLoopPlayback="True"
            ShouldShowPlaybackControls="False"
            Aspect="AspectFill"
            Volume="0"
            VerticalOptions="FillAndExpand"
            HorizontalOptions="FillAndExpand" />-->

        <!-- Semi-transparent overlay -->
        <BoxView Color="Black" Opacity="0.4" />

        <!-- Main Content -->
        <ScrollView>
            <VerticalStackLayout Padding="20" Spacing="20">
                
                <!-- Header -->
                <Label 
                    Text="Aurora Forecast"
                    FontSize="32"
                    FontAttributes="Bold"
                    TextColor="White"
                    HorizontalOptions="Center"
                    Margin="0,20,0,0" />

                <!-- Search Section -->
                <Frame BackgroundColor="#40FFFFFF" 
                       CornerRadius="15"
                       Padding="15"
                       HasShadow="True">
                    <VerticalStackLayout Spacing="10">
                        <Label 
                            Text="Search for a nordic location/town:"
                            FontSize="16"
                            TextColor="White"
                            FontAttributes="Bold" />
                        
                        <HorizontalStackLayout Spacing="10">
                            <Entry 
                                x:Name="CityEntry"
                                Text="{Binding CityName}"
                                Placeholder="T.ex. Ã–stersund, Kiruna..."
                                PlaceholderColor="#CCFFFFFF"
                                TextColor="White"
                                MinimumWidthRequest="100"
                                BackgroundColor="#60000000"
                                HorizontalOptions="Fill"
                                Completed="OnSearchClicked" />
                            
                            <Button 
                                Text="ðŸ”"
                                Command="{Binding SearchCityCommand}"
                                BackgroundColor="#8A2BE2"
                                TextColor="White"
                                WidthRequest="60"
                                HeightRequest="50"
                                CornerRadius="10" />
                        </HorizontalStackLayout>
                    </VerticalStackLayout>
                </Frame>

                <!-- Error Message -->
                <Frame 
                    IsVisible="{Binding HasError}"
                    BackgroundColor="#80FF4444"
                    CornerRadius="10"
                    Padding="15">
                    <Label 
                        Text="{Binding ErrorMessage}"
                        TextColor="White"
                        FontSize="14" />
                </Frame>

                <!-- Loading Indicator -->
                <ActivityIndicator 
                    IsRunning="{Binding IsBusy}"
                    IsVisible="{Binding IsBusy}"
                    Color="White"
                    HeightRequest="50" />

                <!-- Current Forecast -->
                <Frame 
                    IsVisible="{Binding IsDataLoaded}"
                    BackgroundColor="#60FFFFFF"
                    CornerRadius="20"
                    Padding="20"
                    HasShadow="True">
                    <VerticalStackLayout Spacing="15">
                        
                        <Label 
                            Text="ðŸ“ Current prognosis"
                            FontSize="20"
                            FontAttributes="Bold"
                            TextColor="White" />
                        
                        <Label 
                            Text="{Binding LocationInfo}"
                            FontSize="14"
                            TextColor="#E0E0E0" />

                        <BoxView Color="White" Opacity="0.3" HeightRequest="1" />

                        <!-- Kp Index Display -->
                        <Grid ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" ColumnSpacing="10">
                            <VerticalStackLayout Grid.Column="0" Spacing="5">
                                <Label 
                                    Text="Kp-Index"
                                    FontSize="14"
                                    TextColor="#E0E0E0" />
                                <Label 
                                    Text="{Binding CurrentKpIndex, StringFormat='{0:F1}'}"
                                    FontSize="36"
                                    FontAttributes="Bold"
                                    TextColor="#FFD700" />
                            </VerticalStackLayout>

                            <VerticalStackLayout Grid.Column="1" Spacing="5">
                                <Label 
                                    Text="Probability"
                                    FontSize="14"
                                    TextColor="#E0E0E0" />
                                <Label 
                                    Text="{Binding Probability, StringFormat='{0}%'}"
                                    FontSize="36"
                                    FontAttributes="Bold"
                                    TextColor="#00FF7F" />
                            </VerticalStackLayout>
                        </Grid>

                        <Frame 
                            BackgroundColor="#40000000"
                            CornerRadius="10"
                            Padding="15"
                            Margin="0,10,0,0">
                            <VerticalStackLayout Spacing="8">
                                <Label 
                                    Text="{Binding ActivityLevel}"
                                    FontSize="18"
                                    FontAttributes="Bold"
                                    TextColor="White"
                                    HorizontalOptions="Center" />
                                <Label 
                                    Text="{Binding ActivityDescription}"
                                    FontSize="14"
                                    TextColor="#E0E0E0"
                                    HorizontalOptions="Center"
                                    HorizontalTextAlignment="Center" />
                            </VerticalStackLayout>
                        </Frame>
                    </VerticalStackLayout>
                </Frame>

                <!-- 3-Day Forecast -->
                <Frame 
                    IsVisible="{Binding IsDataLoaded}"
                    BackgroundColor="#60FFFFFF"
                    CornerRadius="20"
                    Padding="20"
                    HasShadow="True">
                    <VerticalStackLayout Spacing="15">
                        
                        <Label 
                            Text="ðŸ“… 3 day prognosis"
                            FontSize="20"
                            FontAttributes="Bold"
                            TextColor="White" />                            
                            <CollectionView ItemsSource="{Binding ThreeDayForecast}"
                                            SelectionMode="None">

                            <CollectionView.ItemTemplate>
                                <DataTemplate>
                                    <Frame BackgroundColor="#3A3A3A" 
                                           Margin="0,5"
                                            Padding="15"
                                             CornerRadius="10">
                                        <Grid ColumnDefinitions="Auto,*,Auto" ColumnSpacing="15">

                                            <!-- Icon -->
                                            <Label Grid.Column="0"
                                                   Text="{Binding IconEmoji}"
                                                   FontSize="32"
                                                   VerticalOptions="Center" />

                                            <!-- Date & Activity -->
                                            <VerticalStackLayout Grid.Column="1" 
                                                 VerticalOptions="Center"
                                                 Spacing="2">
                                                <Label Text="{Binding Date}"
                                                        FontSize="16"
                                                      FontAttributes="Bold"
                                                        TextColor="White" />
                                                <Label Text="{Binding ActivityLevel}"
                                                          FontSize="12"
                                                       TextColor="#B0B0B0" />
                                            </VerticalStackLayout>

                                            <!-- Probability % -->
                                            <Label Grid.Column="2"
                                                   FontSize="20"
                                                   FontAttributes="Bold"
                                                   TextColor="#00FF7F"
                                                   VerticalOptions="Center"
                                                   HorizontalOptions="End">
                                                <Label.FormattedText>
                                                    <FormattedString>
                                                        <Span Text="{Binding Probability}" />
                                                        <Span Text="%" />
                                                    </FormattedString>
                                                </Label.FormattedText>
                                            </Label>

                                        </Grid>
                                    </Frame>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Frame>

                <!-- Info Footer -->
                <Label 
                    Text="Data frÃ¥n NOAA Space Weather Prediction Center"
                    FontSize="10"
                    TextColor="#B0B0B0"
                    HorizontalOptions="Center"
                    Margin="0,10,0,20" />

            </VerticalStackLayout>
        </ScrollView>
    </Grid>

</ContentPage>
